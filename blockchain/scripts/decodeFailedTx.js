const { ethers } = require('ethers');
const fs = require('fs');

// Read the ABI
const factoryArtifact = JSON.parse(fs.readFileSync('./artifacts/contracts/ElectionFactory.sol/ElectionFactory.json', 'utf8'));
const iface = new ethers.Interface(factoryArtifact.abi);

// Decode the transaction data
const txData = '0x25ba98a400000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000003e00000000000000000000000000000000000000000000000000000000068d9c2f20000000000000000000000000000000000000000000000000000000068db143600000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000046473666100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000461736466000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000067177656173640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000361736400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000037863760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000373646600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000156372756e6368797061616e40676d61696c2e636f6d0000000000000000000000';

try {
  const decoded = iface.parseTransaction({ data: txData });
  console.log('üîç Decoded Transaction:');
  console.log('Function:', decoded.name);
  console.log('Arguments:');
  
  // Helper function to convert BigInt to string for JSON serialization
  const replacer = (key, value) => typeof value === 'bigint' ? value.toString() : value;
  
  console.log('- ElectionInfo:', JSON.stringify(decoded.args[0], replacer, 2));
  console.log('- Candidates:', JSON.stringify(decoded.args[1], replacer, 2));
  console.log('- BallotType:', decoded.args[2].toString());
  console.log('- ResultType:', decoded.args[3].toString());
  console.log('- Whitelist:', JSON.stringify(decoded.args[4], replacer, 2));
} catch (error) {
  console.error('‚ùå Error decoding:', error.message);
}
